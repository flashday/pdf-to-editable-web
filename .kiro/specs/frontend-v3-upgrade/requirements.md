# 前端 V3 升级需求文档

## 概述

将现有 V2 前端升级为 V3 版本，引入新的 6 步工作流界面设计，增强数据处理能力，同时保持后端 API 兼容性。

## 用户故事

### 1. 工作流步骤控制

#### 1.1 线性工作流导航
作为用户，我希望看到清晰的 6 步工作流进度条，这样我可以了解当前处于哪个步骤，以及整体进度。

**验收标准：**
- 1.1.1 顶部显示 6 个步骤：模型加载 → 上传文件 → 智能识别 → 预录入 → 数据提取与自检 → 财务确认
- 1.1.2 当前步骤高亮显示，已完成步骤显示勾选标记
- 1.1.3 未完成的步骤不可点击跳转（必须按顺序完成）
- 1.1.4 每个步骤显示耗时信息

#### 1.2 步骤间数据传递
作为系统，我需要在步骤间正确传递数据，确保后续步骤能获取前序步骤的处理结果。

**验收标准：**
- 1.2.1 步骤 3 完成后，OCR 结果传递给步骤 4
- 1.2.2 步骤 4 的用户修正结果传递给步骤 5
- 1.2.3 步骤 5 的提取结果和检查点结果传递给步骤 6

---

### 2. 步骤 1-3：模型加载、上传、识别（保持现有功能）

#### 2.1 模型加载
作为用户，我希望系统自动加载 OCR、LLM、RAG 三个服务，并显示加载状态。

**验收标准：**
- 2.1.1 显示三个服务的加载状态（OCR模型/LLM服务/RAG服务）
- 2.1.2 所有服务加载完成后，自动切换到步骤 2
- 2.1.3 任一服务加载失败时显示错误提示

#### 2.2 文件上传
作为用户，我希望能上传 PDF/JPG/PNG 文件进行处理。

**验收标准：**
- 2.2.1 支持拖放上传和点击上传
- 2.2.2 文件大小限制 50MB
- 2.2.3 上传成功后自动进入步骤 3

#### 2.3 智能识别
作为用户，我希望系统使用 PaddleOCR 进行版面分析和文字识别。

**验收标准：**
- 2.3.1 显示识别进度
- 2.3.2 识别完成后显示置信度
- 2.3.3 识别成功后自动进入步骤 4

---

### 3. 步骤 4：预录入（增强）

#### 3.1 预录入界面
作为用户，我希望在预录入界面查看和编辑 OCR 识别结果。

**验收标准：**
- 3.1.1 左侧显示原始文档图片，带 OCR 区域框
- 3.1.2 右侧显示 Block 列表（保持现有 Block 视图）
- 3.1.3 支持左右联动高亮
- 3.1.4 双击 Block 可编辑文本或表格

#### 3.2 编辑保存功能（新增）
作为用户，我希望编辑后的内容能保存到后端，供后续步骤使用。

**验收标准：**
- 3.2.1 编辑后点击"保存修正"按钮，将修正内容保存到后端
- 3.2.2 保存时记录：原始文本、修正文本、修正时间、Block 索引
- 3.2.3 保存成功后显示提示
- 3.2.4 修正记录保存在 `temp/{job_id}_corrections.json`

#### 3.3 进入下一步
作为用户，我希望确认预录入完成后，能进入数据提取步骤。

**验收标准：**
- 3.3.1 显示"确认并进入下一步"按钮
- 3.3.2 点击后将修正后的文本（或原始文本）传递给步骤 5
- 3.3.3 进入步骤 5 后，步骤 4 标记为已完成

---

### 4. 步骤 5：数据提取与自检（增强）

#### 4.1 关键词模板提取
作为用户，我希望系统按照预设的关键词模板从文档中提取数据。

**验收标准：**
- 4.1.1 支持选择预设模板（发票、合同、身份证、简历等）
- 4.1.2 支持自定义提取字段
- 4.1.3 使用步骤 4 的修正文本（如有）作为提取源
- 4.1.4 提取结果以 JSON 格式显示

#### 4.2 检查点自检
作为用户，我希望系统自动执行预设的检查点问题，验证提取结果的正确性。

**验收标准：**
- 4.2.1 支持配置检查点问题列表
- 4.2.2 每个检查点问题自动发送给 LLM 进行推理
- 4.2.3 显示每个检查点的答案和置信度
- 4.2.4 检查点结果保存在 `temp/{job_id}_checkpoints.json`

#### 4.3 进入下一步
作为用户，我希望提取和自检完成后，能进入财务确认步骤。

**验收标准：**
- 4.3.1 显示"确认并进入下一步"按钮
- 4.3.2 点击后将提取结果和检查点结果传递给步骤 6

---

### 5. 步骤 6：财务确认（新增）

#### 5.1 财务确认界面
作为用户，我希望在最终确认界面查看所有提取结果和检查点答案。

**验收标准：**
- 5.1.1 上半部分显示检查点答案列表
- 5.1.2 下半部分显示按关键词提取的 JSON 数据
- 5.1.3 支持展开/折叠 JSON 数据
- 5.1.4 支持复制 JSON 数据

#### 5.2 最终确认
作为用户，我希望能确认或驳回处理结果。

**验收标准：**
- 5.2.1 显示"确认"和"驳回"按钮
- 5.2.2 确认后保存最终结果到 `temp/{job_id}_final_result.json`
- 5.2.3 驳回后可返回步骤 4 重新编辑

---

### 6. 独立子界面

#### 6.1 历史缓存子界面
作为用户，我希望能查看和管理历史处理记录。

**验收标准：**
- 6.1.1 独立的历史记录面板（可展开/收起）
- 6.1.2 显示历史任务列表（文件名、时间、置信度）
- 6.1.3 点击历史记录可加载缓存结果
- 6.1.4 支持删除历史记录

#### 6.2 关键词模板设定子界面
作为用户，我希望能管理关键词提取模板。

**验收标准：**
- 6.2.1 独立的模板管理面板
- 6.2.2 显示预设模板列表
- 6.2.3 支持新增自定义模板
- 6.2.4 支持编辑和删除模板
- 6.2.5 模板保存在本地存储或后端

#### 6.3 检查点设定子界面
作为用户，我希望能管理检查点问题列表。

**验收标准：**
- 6.3.1 独立的检查点管理面板
- 6.3.2 显示检查点问题列表
- 6.3.3 支持新增、编辑、删除检查点问题
- 6.3.4 检查点配置保存在本地存储或后端

---

### 7. 审计追溯

#### 7.1 修正记录追溯
作为审计人员，我希望能查看用户对 OCR 结果的修正记录。

**验收标准：**
- 7.1.1 修正记录包含：Block 索引、原始文本、修正文本、修正时间
- 7.1.2 修正记录保存在 `temp/{job_id}_corrections.json`
- 7.1.3 支持导出修正记录

#### 7.2 处理流程追溯
作为审计人员，我希望能查看完整的处理流程记录。

**验收标准：**
- 7.2.1 记录每个步骤的开始时间、结束时间、状态
- 7.2.2 记录提取结果和检查点结果
- 7.2.3 记录最终确认/驳回操作

---

## 非功能需求

### 8. 兼容性

#### 8.1 后端 API 兼容
- 8.1.1 保持现有 API 接口不变
- 8.1.2 新增 API 使用新的端点路径

#### 8.2 数据兼容
- 8.2.1 现有缓存数据可继续使用
- 8.2.2 新增的缓存文件不影响现有功能

### 9. 技术约束

#### 9.1 前端技术栈
- 9.1.1 保持纯原生 JS + CSS（不引入 React/Vue）
- 9.1.2 使用 Vite 作为开发服务器
- 9.1.3 代码模块化重构

#### 9.2 文件组织
- 9.2.1 CSS 从 index.html 抽取到独立文件
- 9.2.2 JS 按功能模块拆分
- 9.2.3 每个步骤对应独立的组件文件
