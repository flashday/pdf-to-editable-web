# 前端 V3 升级任务列表

## 阶段一：基础重构

### 1. CSS 抽取与模块化
- [ ] 1.1 创建 `styles/` 目录结构
- [ ] 1.2 从 index.html 抽取 CSS 变量和重置样式到 `base.css`
- [ ] 1.3 抽取布局样式到 `layout.css`
- [ ] 1.4 抽取步骤进度条样式到 `steps.css`
- [ ] 1.5 抽取面板样式到 `panels.css`
- [ ] 1.6 抽取组件样式到 `components.css`
- [ ] 1.7 更新 index.html 引入 CSS 文件
- [ ] 1.8 验证样式抽取后界面显示正常

### 2. 核心服务创建
- [ ] 2.1 创建 `EventBus.js` 事件总线
- [ ] 2.2 创建 `StateManager.js` 状态管理器
- [ ] 2.3 创建 `StepManager.js` 步骤管理器
- [ ] 2.4 编写核心服务单元测试

### 3. index.html 精简
- [ ] 3.1 移除 index.html 中的内联 `<style>` 标签
- [ ] 3.2 移除 index.html 底部的补丁 `<script>` 代码
- [ ] 3.3 整合补丁代码到对应模块
- [ ] 3.4 验证精简后功能正常

---

## 阶段二：步骤组件化

### 4. 步骤 1-3 组件封装
- [ ] 4.1 创建 `components/steps/` 目录
- [ ] 4.2 创建 `Step1ModelLoad.js` 封装模型加载逻辑
- [ ] 4.3 创建 `Step2FileUpload.js` 封装文件上传逻辑
- [ ] 4.4 创建 `Step3Recognition.js` 封装智能识别逻辑
- [ ] 4.5 更新 index.js 使用步骤组件
- [ ] 4.6 验证步骤 1-3 功能正常

### 5. 步骤 4 预录入增强
- [ ] 5.1 创建 `Step4PreEntry.js` 组件
- [ ] 5.2 实现 Block 编辑功能
- [ ] 5.3 实现修正记录保存功能
- [ ] 5.4 实现"确认并进入下一步"按钮
- [ ] 5.5 实现修正文本合并逻辑
- [ ] 5.6 编写步骤 4 单元测试

### 6. 步骤 5 数据提取与自检
- [ ] 6.1 创建 `Step5DataExtract.js` 组件
- [ ] 6.2 实现模板选择界面
- [ ] 6.3 实现关键词提取功能（调用 LLM）
- [ ] 6.4 实现检查点执行功能
- [ ] 6.5 实现提取结果显示
- [ ] 6.6 实现检查点结果显示
- [ ] 6.7 实现"确认并进入下一步"按钮
- [ ] 6.8 编写步骤 5 单元测试

### 7. 步骤 6 财务确认（新增）
- [ ] 7.1 创建 `Step6Confirmation.js` 组件
- [ ] 7.2 实现检查点答案列表显示
- [ ] 7.3 实现 JSON 数据展示（可展开/折叠）
- [ ] 7.4 实现 JSON 复制功能
- [ ] 7.5 实现"确认"按钮逻辑
- [ ] 7.6 实现"驳回"按钮逻辑（返回步骤 4）
- [ ] 7.7 编写步骤 6 单元测试

---

## 阶段三：独立面板组件

### 8. 历史缓存面板
- [ ] 8.1 创建 `components/panels/` 目录
- [ ] 8.2 创建 `HistoryPanel.js` 组件
- [ ] 8.3 实现历史任务列表显示
- [ ] 8.4 实现点击加载历史记录
- [ ] 8.5 实现删除历史记录功能
- [ ] 8.6 实现面板展开/收起动画

### 9. 关键词模板面板
- [ ] 9.1 创建 `TemplatePanel.js` 组件
- [ ] 9.2 实现预设模板列表显示
- [ ] 9.3 实现新增自定义模板
- [ ] 9.4 实现编辑模板功能
- [ ] 9.5 实现删除模板功能
- [ ] 9.6 实现模板本地存储

### 10. 检查点设定面板
- [ ] 10.1 创建 `CheckpointPanel.js` 组件
- [ ] 10.2 实现检查点问题列表显示
- [ ] 10.3 实现新增检查点问题
- [ ] 10.4 实现编辑检查点问题
- [ ] 10.5 实现删除检查点问题
- [ ] 10.6 实现检查点配置本地存储

---

## 阶段四：后端 API 扩展

### 11. 修正记录 API
- [ ] 11.1 创建 `/api/corrections/{job_id}` POST 端点
- [ ] 11.2 创建 `/api/corrections/{job_id}` GET 端点
- [ ] 11.3 实现修正记录保存到 `temp/{job_id}_corrections.json`
- [ ] 11.4 编写修正记录 API 测试

### 12. 检查点 API
- [ ] 12.1 创建 `/api/checkpoints/{job_id}` POST 端点
- [ ] 12.2 创建 `/api/checkpoints/{job_id}` GET 端点
- [ ] 12.3 实现检查点结果保存到 `temp/{job_id}_checkpoints.json`
- [ ] 12.4 编写检查点 API 测试

### 13. 最终结果 API
- [ ] 13.1 创建 `/api/final/{job_id}` POST 端点
- [ ] 13.2 创建 `/api/final/{job_id}` GET 端点
- [ ] 13.3 实现最终结果保存到 `temp/{job_id}_final_result.json`
- [ ] 13.4 编写最终结果 API 测试

### 14. 模板管理 API
- [ ] 14.1 创建 `/api/templates` GET 端点
- [ ] 14.2 创建 `/api/templates` POST 端点
- [ ] 14.3 创建 `/api/templates/{id}` PUT 端点
- [ ] 14.4 创建 `/api/templates/{id}` DELETE 端点
- [ ] 14.5 实现模板存储（JSON 文件或数据库）
- [ ] 14.6 编写模板 API 测试

### 15. 检查点配置 API
- [ ] 15.1 创建 `/api/checkpoint-config` GET 端点
- [ ] 15.2 创建 `/api/checkpoint-config` POST 端点
- [ ] 15.3 实现检查点配置存储
- [ ] 15.4 编写检查点配置 API 测试

---

## 阶段五：集成与测试

### 16. 集成测试
- [ ] 16.1 编写完整工作流集成测试（步骤 1-6）
- [ ] 16.2 编写修正数据传递测试（步骤 4→5）
- [ ] 16.3 编写驳回流程测试（步骤 6→4）
- [ ] 16.4 编写数据持久化测试

### 17. UI/UX 优化
- [ ] 17.1 优化步骤进度条动画
- [ ] 17.2 优化面板展开/收起动画
- [ ] 17.3 添加加载状态指示器
- [ ] 17.4 添加操作成功/失败提示
- [ ] 17.5 响应式布局适配

### 18. 文档更新
- [ ] 18.1 更新 README.md 添加 V3 功能说明
- [ ] 18.2 更新 CHANGELOG.md 记录变更
- [ ] 18.3 创建用户操作指南

---

## 任务依赖关系

```
阶段一 (1-3) ──┬──> 阶段二 (4-7) ──┬──> 阶段五 (16-18)
               │                    │
               └──> 阶段三 (8-10) ──┤
                                    │
阶段四 (11-15) ─────────────────────┘
```

## 预估工时

| 阶段 | 任务数 | 预估工时 |
|------|--------|----------|
| 阶段一：基础重构 | 16 | 1-2 天 |
| 阶段二：步骤组件化 | 28 | 3-4 天 |
| 阶段三：独立面板 | 18 | 2-3 天 |
| 阶段四：后端 API | 20 | 2-3 天 |
| 阶段五：集成测试 | 9 | 1-2 天 |
| **总计** | **91** | **9-14 天** |

## 优先级说明

- 阶段一、二为核心功能，必须完成
- 阶段三、四可根据时间灵活调整
- 阶段五为质量保障，建议完成
